# =============================================================================
# nself-tv Configuration - Development Environment
# =============================================================================
# This is the CANONICAL configuration file for nself-tv.
# Committed to git. Contains safe development defaults.
# Override locally with .env.local (gitignored).
# =============================================================================

# -----------------------------------------------------------------------------
# 1. PROJECT BASICS
# -----------------------------------------------------------------------------
PROJECT_NAME=nself-tv
COMPOSE_PROJECT_NAME=ntv
ENV=dev
BASE_DOMAIN=local.nself.org

# Core Services
POSTGRES_ENABLED=true
HASURA_ENABLED=true
AUTH_ENABLED=true
NGINX_ENABLED=true

# White-Label & Deployment Topology
# NTV_MODE: Controls deployment topology and default service configuration
#   - 'standalone' (default): Dedicated backend for nTV only
#       * Enables all services (monitoring, MinIO, Redis, etc.)
#       * Storage: S3/MinIO by default
#       * Auth: Standalone nhost-auth instance
#       * Best for: Single-app self-hosted deployments
#   - 'monorepo': Shared backend with multiple nself apps
#       * Minimal services (shares auth, database, storage with other apps)
#       * Storage: Shared S3/MinIO bucket with app-specific prefixes
#       * Auth: Shared nhost-auth, SSO between apps, per-app RBAC
#       * Best for: Running multiple nself apps (chat, tv, family) together
#   - 'nas': Optimized for NAS/low-resource deployments
#       * Minimal services (monitoring disabled, workers=1)
#       * Storage: Local filesystem by default
#       * Hardware transcoding auto-detected (Intel QSV, NVIDIA, VAAPI)
#       * Best for: Synology, QNAP, Unraid, Raspberry Pi
NTV_MODE=standalone
# NTV_BACKEND_URL: Override for backend discovery (optional)
# Leave empty to use auto-discovery (localhost in dev, same-origin in prod)
NTV_BACKEND_URL=
# Feature flags: comma-separated list of enabled features
# Options: vod,liveTV,sports,podcasts,games,dvr,downloads,watchParty
# Default: all enabled in dev
NTV_FEATURES=vod,liveTV,sports,podcasts,games,dvr,downloads,watchParty

# -----------------------------------------------------------------------------
# 2. POSTGRESQL DATABASE
# -----------------------------------------------------------------------------
POSTGRES_DB=nself_tv_db
POSTGRES_USER=postgres
POSTGRES_PASSWORD=dev_password_change_in_prod
POSTGRES_PORT=5432
POSTGRES_VERSION=15

# -----------------------------------------------------------------------------
# 3. HASURA GRAPHQL ENGINE
# -----------------------------------------------------------------------------
HASURA_GRAPHQL_ADMIN_SECRET=dev_admin_secret_change_in_prod
HASURA_PORT=8080
HASURA_VERSION=v2.38.0
HASURA_CONSOLE=true
HASURA_DEV_MODE=true
HASURA_UNAUTHORIZED_ROLE=anonymous

# JWT Configuration (shared with Auth service)
HASURA_JWT_SECRET='{"type":"HS256","key":"your-jwt-secret-must-be-at-least-32-characters-long"}'

# -----------------------------------------------------------------------------
# 4. AUTHENTICATION (nhost-auth)
# -----------------------------------------------------------------------------
AUTH_PORT=4000
AUTH_VERSION=latest
AUTH_HOST=0.0.0.0
AUTH_JWT_SECRET='{"type":"HS256","key":"your-jwt-secret-must-be-at-least-32-characters-long"}'
HASURA_GRAPHQL_JWT_SECRET='{"type":"HS256","key":"your-jwt-secret-must-be-at-least-32-characters-long"}'

# Stream Gateway JWT (for playback token signing)
JWT_SECRET=dev-stream-jwt-secret-must-be-at-least-32-characters

# Token expiry (in seconds)
# 15 minutes (short-lived for security)
AUTH_ACCESS_TOKEN_EXPIRES_IN=900
# 30 days
AUTH_REFRESH_TOKEN_EXPIRES_IN=2592000
AUTH_CLIENT_URL=http://app.local.nself.org

# Auth providers (optional)
AUTH_GOOGLE_ENABLED=false
AUTH_GITHUB_ENABLED=false

# -----------------------------------------------------------------------------
# 5. OPTIONAL SERVICES
# -----------------------------------------------------------------------------

# Redis (caching, sessions, queues)
REDIS_ENABLED=true
REDIS_PORT=6379
REDIS_VERSION=7

# MinIO (S3-compatible object storage)
MINIO_ENABLED=true
MINIO_PORT=9000
MINIO_CONSOLE_PORT=9001
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=minioadmin
MINIO_VERSION=latest
MINIO_BUCKET_RAW=media-raw
MINIO_BUCKET_ENCODED=media-encoded
MINIO_BUCKET_THUMBNAILS=media-thumbnails
MINIO_BUCKET_SUBTITLES=media-subtitles
MINIO_BUCKET_BACKUPS=backups

# MeiliSearch (search engine)
MEILISEARCH_ENABLED=true
MEILISEARCH_PORT=7700
MEILISEARCH_MASTER_KEY=dev_meilisearch_key_change_in_prod
MEILISEARCH_VERSION=v1.5

# MailPit (development email testing)
MAILPIT_ENABLED=true
MAILPIT_SMTP_PORT=1025
MAILPIT_UI_PORT=8025

# -----------------------------------------------------------------------------
# 6. MONITORING STACK (Optional - 10 services when enabled)
# -----------------------------------------------------------------------------
MONITORING_ENABLED=true

# Prometheus (metrics collection)
PROMETHEUS_PORT=9090
PROMETHEUS_VERSION=latest

# Grafana (metrics visualization)
GRAFANA_PORT=3000
GRAFANA_VERSION=latest
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=admin

# Loki (log aggregation)
LOKI_PORT=3100
LOKI_VERSION=2.9.0

# AlertManager (alert routing)
ALERTMANAGER_PORT=9093

# Note: Promtail, Tempo, cAdvisor, Node Exporter, DB Exporters auto-configured

# -----------------------------------------------------------------------------
# 7. CUSTOM MICROSERVICES
# -----------------------------------------------------------------------------
# Phase 6: All 21 plugins run as external Node.js processes (Option 1)
# Started via: backend/start-plugins.sh
# Stopped via: backend/stop-plugins.sh
# Managed independently from Docker Compose
# See nself CLI team guidance: .ai/temp/done-review-20260214-163650.md
#
# Note: CS_N Docker option available (Option 2) but requires copying plugin
# code to services/ directories. External processes are simpler and recommended.

# -----------------------------------------------------------------------------
# 8. FRONTEND APPLICATIONS (External - Not in Docker)
# -----------------------------------------------------------------------------

# Web Platform (Next.js)
FRONTEND_APP_1_NAME=web
FRONTEND_APP_1_PORT=3000
FRONTEND_APP_1_ROUTE=app
# Access: http://app.local.nself.org
# Start: cd frontend/platforms/web && npm run dev

# TV Platform (React Native Web)
FRONTEND_APP_2_NAME=tv
FRONTEND_APP_2_PORT=3001
FRONTEND_APP_2_ROUTE=tv
# Access: http://tv.local.nself.org
# Start: cd frontend/platforms/tv && npm run dev:web

# Mobile Platform (React Native Metro - dev preview only)
FRONTEND_APP_3_NAME=mobile
FRONTEND_APP_3_PORT=8081
FRONTEND_APP_3_ROUTE=mobile
# Access: http://mobile.local.nself.org
# Start: cd frontend/platforms/mobile && npm start

# Desktop Platform (Tauri dev server)
FRONTEND_APP_4_NAME=desktop
FRONTEND_APP_4_PORT=3002
FRONTEND_APP_4_ROUTE=desktop
# Access: http://desktop.local.nself.org
# Start: cd frontend/platforms/desktop && npm run tauri dev

# -----------------------------------------------------------------------------
# 9. APPLICATION-SPECIFIC CONFIGURATION
# -----------------------------------------------------------------------------

# Video Processing
VIDEO_TRANSCODE_FORMATS=mp4,webm,hls
VIDEO_QUALITY_LEVELS=360p,720p,1080p,4k
VIDEO_MAX_UPLOAD_SIZE=5GB

# CDN Configuration (for production)
CDN_ENABLED=false
CDN_ENDPOINT=https://cdn.nself.org
CDN_CACHE_TTL=86400

# Content Moderation
MODERATION_ENABLED=true
MODERATION_AUTO_APPROVE=false

# Analytics
ANALYTICS_ENABLED=true
ANALYTICS_PROVIDER=plausible

# -----------------------------------------------------------------------------
# 10. EXTERNAL SERVICE INTEGRATIONS (Optional)
# -----------------------------------------------------------------------------

# Stripe (payments - if needed)
STRIPE_ENABLED=false
STRIPE_PUBLIC_KEY=pk_test_...
STRIPE_SECRET_KEY=sk_test_...

# Twilio (notifications - if needed)
TWILIO_ENABLED=false
TWILIO_ACCOUNT_SID=AC...
TWILIO_AUTH_TOKEN=...

# AWS S3 (production storage - alternative to MinIO)
AWS_S3_ENABLED=false
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=...
AWS_SECRET_ACCESS_KEY=...
AWS_S3_BUCKET=nself-tv-prod-media

# -----------------------------------------------------------------------------
# 11. NSELF PLUGINS
# -----------------------------------------------------------------------------
# Phase 6: All backend services migrated to plugins (21 total)
# Install via: nself plugin install <plugin-name>

# Legacy CS_N compatibility (test contract support)
# -------------------------------------------------
# These entries are preserved for Phase 1-4 regression tests that parse CS_1..CS_10.
CS_1=library_service:gin:5001
CS_2=discovery_service:gin:5002
CS_3=stream_gateway:gin:5003
CS_4=recommendation_engine:fastapi:5004
CS_5=video_processor:bullmq-js:5005
CS_6=thumbnail_generator:bullmq-js:5006
CS_7=devices:plugin:3603
CS_8=epg:plugin:3031
CS_9=sports:plugin:3035
CS_10=recording:plugin:3602

# Core Services (ex-CS_2 through CS_10)
# ----------------------------------------

# Discovery functionality - use search plugin + frontend logic (discovery plugin was incomplete and removed)
# DISCOVERY_PLUGIN_ENABLED=true
# DISCOVERY_PLUGIN_PORT=3022

# Stream Gateway Plugin (ex-CS_3 - admission control, signed URLs, sessions)
# TEMPORARILY DISABLED - TypeScript compilation errors (6 errors)
STREAM_GATEWAY_PLUGIN_ENABLED=false
STREAM_GATEWAY_PLUGIN_PORT=3601

# Recommendation functionality - use ai or activity-feed plugins (recommendation-engine plugin was incomplete and removed)
# RECOMMENDATION_PLUGIN_ENABLED=true
# RECOMMENDATION_PLUGIN_PORT=5004

# Media Processing Plugin (ex-CS_5 - HLS encoding, trickplay, adaptive bitrate)
# TEMPORARILY DISABLED - TypeScript compilation errors (7 errors)
MEDIA_PROCESSING_PLUGIN_ENABLED=false
MEDIA_PROCESSING_PLUGIN_PORT=3019
MEDIA_PROCESSING_FFMPEG_THREADS=4
MEDIA_PROCESSING_HW_ACCEL=false
MEDIA_PROCESSING_QUALITY_LADDER=240,360,480,720,1080,2160

# File Processing Plugin (ex-CS_6 - posters, sprites, optimization)
FILE_PROCESSING_PLUGIN_ENABLED=true
FILE_PROCESSING_PLUGIN_PORT=3104

# Media scanning - application-level logic (media-scanner plugin was incomplete and removed)
# MEDIA_SCANNER_PLUGIN_ENABLED=true
# MEDIA_SCANNER_PLUGIN_PORT=5003
# MEDIA_SCANNER_WATCH_PATHS=/media/raw
# MEDIA_SCANNER_RESCAN_INTERVAL=3600

# Live TV & DVR Plugins (Phase 5)
# ----------------------------------------

# Devices Plugin (IoT device enrollment, trust management)
DEVICES_PLUGIN_ENABLED=true
DEVICES_PLUGIN_PORT=3603
DEV_ENROLLMENT_TOKEN_TTL=86400
DEV_CHALLENGE_TTL=300
DEV_HEARTBEAT_INTERVAL=30
DEV_HEARTBEAT_TIMEOUT=90
DEV_COMMAND_DEFAULT_TIMEOUT=30
DEV_COMMAND_MAX_RETRIES=3
DEV_TELEMETRY_RETENTION_DAYS=90

# EPG Plugin (Electronic Program Guide)
EPG_PLUGIN_ENABLED=true
EPG_PLUGIN_PORT=3031
EPG_APP_IDS=nself-tv
EPG_XMLTV_URLS=https://raw.githubusercontent.com/iptv-org/epg/master/sites/xmltv/xmltv.org.channels.xml
EPG_SCHEDULES_DIRECT_USERNAME=
EPG_SCHEDULES_DIRECT_PASSWORD=
EPG_DEFAULT_TIMEZONE=America/New_York
EPG_GUIDE_DAYS_AHEAD=7

# Sports Plugin (Sports data, live scores, schedules)
SPORTS_PLUGIN_ENABLED=true
SPORTS_PLUGIN_PORT=3035
SPORTS_APP_IDS=nself-tv
SPORTS_PROVIDER=espn
SPORTS_PROVIDERS=espn,sportsdata
SPORTS_ESPN_API_KEY=
SPORTS_ESPN_API_URL=https://site.api.espn.com/apis/site/v2
SPORTS_SPORTSDATA_API_KEY=

# Recording Plugin (DVR recording orchestration)
RECORDING_PLUGIN_ENABLED=true
RECORDING_PLUGIN_PORT=3602
REC_STORAGE_URL=http://minio:9000
REC_FILE_PROCESSING_URL=http://media-processing:3019
REC_SPORTS_URL=http://sports:3036
REC_MEDIA_METADATA_URL=http://library_service:5001
REC_DEVICES_URL=http://devices:3603
REC_DEFAULT_LEAD_TIME_MINUTES=2
REC_DEFAULT_TRAIL_TIME_MINUTES=5

# Content Acquisition Plugins (Phase 6)
# ----------------------------------------
# NOTE: 7 plugins currently have TypeScript errors - disabled until plugin team fixes
# See: ~/Sites/nself/FEEDBACK.md (2026-02-14)

# VPN Plugin (secure P2P traffic, kill-switch, leak protection)
# TEMPORARILY DISABLED - TypeScript compilation errors (8 errors)
VPN_PLUGIN_ENABLED=false
VPN_PLUGIN_PORT=3200
VPN_PROVIDER=nordvpn
VPN_PROTOCOL=wireguard
VPN_P2P_OPTIMIZED=true
VPN_KILL_SWITCH=true
VPN_DNS_LEAK_PROTECTION=true
VPN_AUTO_RECONNECT=true

# Torrent Manager Plugin (search, download, seeding)
# TEMPORARILY DISABLED - TypeScript compilation errors (17 errors)
TORRENT_MANAGER_PLUGIN_ENABLED=false
TORRENT_MANAGER_PLUGIN_PORT=3201
TORRENT_CLIENT=transmission
TORRENT_SEED_RATIO=2.0
TORRENT_MAX_ACTIVE=3
TORRENT_DOWNLOAD_DIR=/media/torrents/incomplete
TORRENT_COMPLETE_DIR=/media/torrents/complete
TORRENT_WATCH_DIR=/media/torrents/watch
TORRENT_BANDWIDTH_SCHEDULE_ENABLED=false

# Content Acquisition Plugin (orchestrator - RSS, subscriptions, rules, state machine)
# TEMPORARILY DISABLED - TypeScript compilation errors (14 errors)
CONTENT_ACQUISITION_PLUGIN_ENABLED=false
CONTENT_ACQUISITION_PLUGIN_PORT=3202
MAX_CONCURRENT_DOWNLOADS=3
ACQUISITION_CHECK_INTERVAL=300
NTV_MOVIE_REGION=US
NTV_MOVIE_LANGUAGE=en
NTV_DEFAULT_QUALITY_PROFILE=balanced
NTV_AUTO_UPGRADE_ENABLED=true

# Subtitle Manager Plugin (fetch, sync, multi-language)
# TEMPORARILY DISABLED - TypeScript compilation errors (9 errors)
SUBTITLE_MANAGER_PLUGIN_ENABLED=false
SUBTITLE_MANAGER_PLUGIN_PORT=3204
SUBTITLE_PREFERRED_LANGUAGES=en,es,ar
SUBTITLE_SYNC_TOOL=alass
SUBTITLE_AUTO_DOWNLOAD=true
SUBTITLE_PROVIDERS=opensubtitles,subscene

# Infrastructure & Automation Plugins
# ----------------------------------------

# Jobs Plugin (BullMQ job queue management)
JOBS_PLUGIN_ENABLED=true
JOBS_PLUGIN_PORT=3105
JOBS_REDIS_URL=redis://localhost:6379
JOBS_MAX_CONCURRENT=5
JOBS_DEFAULT_ATTEMPTS=3
JOBS_DEFAULT_BACKOFF_DELAY=5000

# Workflows Plugin (workflow automation engine)
WORKFLOWS_PLUGIN_ENABLED=true
WORKFLOWS_PLUGIN_PORT=3712
WORKFLOWS_MAX_CONCURRENT_EXECUTIONS=10
WORKFLOWS_APPROVAL_TIMEOUT_MINUTES=1440
WORKFLOWS_WEBHOOK_SECRET=dev-webhook-secret-change-in-prod

# Tokens Plugin (content delivery tokens & HLS encryption)
TOKENS_PLUGIN_ENABLED=true
TOKENS_PLUGIN_PORT=3107
TOKENS_DEFAULT_EXPIRY_SECONDS=3600
TOKENS_SIGNING_KEY_ROTATION_DAYS=30
TOKENS_HLS_ENCRYPTION_ALGORITHM=AES-128-CBC

# User Feature Plugins
# ----------------------------------------

# Content Progress Plugin (playback progress tracking)
CONTENT_PROGRESS_PLUGIN_ENABLED=true
CONTENT_PROGRESS_PLUGIN_PORT=3023
PROGRESS_COMPLETE_THRESHOLD=95
PROGRESS_HISTORY_SAMPLE_SECONDS=30
PROGRESS_HISTORY_RETENTION_DAYS=365

# Gaming Plugins (Phase 8 early integration)
# ----------------------------------------

# Retro Gaming Plugin (ROM library & emulator serving)
RETRO_GAMING_PLUGIN_ENABLED=false
RETRO_GAMING_PLUGIN_PORT=3033
RETRO_GAMING_IGDB_CLIENT_ID=
RETRO_GAMING_IGDB_CLIENT_SECRET=
RETRO_GAMING_MOBYGAMES_API_KEY=

# ROM Discovery Plugin (ROM metadata & download queue)
ROM_DISCOVERY_PLUGIN_ENABLED=false
ROM_DISCOVERY_PLUGIN_PORT=3034
ROM_DISCOVERY_ENABLE_SCRAPERS=false
ROM_DISCOVERY_SCRAPER_SCHEDULE="0 3 * * *"
ROM_DISCOVERY_DEFAULT_QUALITY_MIN=50
ROM_DISCOVERY_MAX_CONCURRENT_DOWNLOADS=3

# Metadata Enrichment Plugin
# ----------------------------------------

# Metadata Enrichment Plugin (TMDB metadata enrichment)
# TEMPORARILY DISABLED - TypeScript compilation errors (12 errors)
METADATA_ENRICHMENT_PLUGIN_ENABLED=false
METADATA_ENRICHMENT_PLUGIN_PORT=3203
TMDB_API_KEY=
TVDB_API_KEY=
MUSICBRAINZ_USER_AGENT=nself-tv/1.0.0

# -----------------------------------------------------------------------------
# NOTES
# -----------------------------------------------------------------------------
# - This file is committed to git (safe defaults only)
# - Create .env.local for personal overrides (gitignored)
# - Production secrets go in .env.prod + .secrets (on server only)
# - Run: nself build && nself start
# - Hasura Console: http://api.local.nself.org/console
# - Grafana: http://grafana.local.nself.org
# - MinIO Console: http://minio.local.nself.org

# Database URL for plugins (auto-constructed from POSTGRES_* vars)
DATABASE_URL=postgresql://postgres:dev_password_change_in_prod@localhost:5432/nself_tv_db
