# =============================================================================
# nself-tv Configuration - Development Environment
# =============================================================================
# This is the CANONICAL configuration file for nself-tv.
# Committed to git. Contains safe development defaults.
# Override locally with .env.local (gitignored).
# =============================================================================

# -----------------------------------------------------------------------------
# 1. PROJECT BASICS
# -----------------------------------------------------------------------------
PROJECT_NAME=nself-tv
COMPOSE_PROJECT_NAME=ntv
ENV=dev
BASE_DOMAIN=local.nself.org

# Core Services
POSTGRES_ENABLED=true
HASURA_ENABLED=true
AUTH_ENABLED=true
NGINX_ENABLED=true

# -----------------------------------------------------------------------------
# 2. POSTGRESQL DATABASE
# -----------------------------------------------------------------------------
POSTGRES_DB=nself_tv_db
POSTGRES_USER=postgres
POSTGRES_PASSWORD=dev_password_change_in_prod
POSTGRES_PORT=5432
POSTGRES_VERSION=15

# -----------------------------------------------------------------------------
# 3. HASURA GRAPHQL ENGINE
# -----------------------------------------------------------------------------
HASURA_GRAPHQL_ADMIN_SECRET=dev_admin_secret_change_in_prod
HASURA_PORT=8080
HASURA_VERSION=v2.38.0
HASURA_CONSOLE=true
HASURA_DEV_MODE=true
HASURA_UNAUTHORIZED_ROLE=anonymous

# JWT Configuration (shared with Auth service)
HASURA_JWT_SECRET={"type":"HS256","key":"your-jwt-secret-must-be-at-least-32-characters-long"}

# -----------------------------------------------------------------------------
# 4. AUTHENTICATION (nhost-auth)
# -----------------------------------------------------------------------------
AUTH_PORT=4000
AUTH_VERSION=latest
AUTH_HOST=0.0.0.0
AUTH_JWT_SECRET={"type":"HS256","key":"your-jwt-secret-must-be-at-least-32-characters-long"}

# Auth providers (optional)
AUTH_GOOGLE_ENABLED=false
AUTH_GITHUB_ENABLED=false

# -----------------------------------------------------------------------------
# 5. OPTIONAL SERVICES
# -----------------------------------------------------------------------------

# Redis (caching, sessions, queues)
REDIS_ENABLED=true
REDIS_PORT=6379
REDIS_VERSION=7

# MinIO (S3-compatible object storage)
MINIO_ENABLED=true
MINIO_PORT=9000
MINIO_CONSOLE_PORT=9001
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=minioadmin
MINIO_VERSION=latest
MINIO_BUCKET_RAW=media-raw
MINIO_BUCKET_ENCODED=media-encoded
MINIO_BUCKET_THUMBNAILS=media-thumbnails
MINIO_BUCKET_SUBTITLES=media-subtitles
MINIO_BUCKET_BACKUPS=backups

# MeiliSearch (search engine)
MEILISEARCH_ENABLED=true
MEILISEARCH_PORT=7700
MEILISEARCH_MASTER_KEY=dev_meilisearch_key_change_in_prod
MEILISEARCH_VERSION=v1.5

# MailPit (development email testing)
MAILPIT_ENABLED=true
MAILPIT_SMTP_PORT=1025
MAILPIT_UI_PORT=8025

# -----------------------------------------------------------------------------
# 6. MONITORING STACK (Optional - 10 services when enabled)
# -----------------------------------------------------------------------------
MONITORING_ENABLED=true

# Prometheus (metrics collection)
PROMETHEUS_PORT=9090
PROMETHEUS_VERSION=latest

# Grafana (metrics visualization)
GRAFANA_PORT=3000
GRAFANA_VERSION=latest
GRAFANA_ADMIN_USER=admin
GRAFANA_ADMIN_PASSWORD=admin

# Loki (log aggregation)
LOKI_PORT=3100
LOKI_VERSION=2.9.0

# AlertManager (alert routing)
ALERTMANAGER_PORT=9093

# Note: Promtail, Tempo, cAdvisor, Node Exporter, DB Exporters auto-configured

# -----------------------------------------------------------------------------
# 7. CUSTOM MICROSERVICES (CS_1 through CS_10)
# -----------------------------------------------------------------------------
# Format: CS_N=service_name:template_type:port

CS_1=library_service:gin:5001
CS_2=discovery_service:gin:5002
CS_3=stream_gateway:gin:5003
CS_4=recommendation_engine:fastapi:5004
CS_5=video_processor:bullmq-js:5005
CS_6=thumbnail_generator:bullmq-js:5006

# -----------------------------------------------------------------------------
# 8. FRONTEND APPLICATIONS (External - Not in Docker)
# -----------------------------------------------------------------------------

# Web Platform (Next.js)
FRONTEND_APP_1_NAME=web
FRONTEND_APP_1_PORT=3000
FRONTEND_APP_1_ROUTE=app
# Access: http://app.local.nself.org
# Start: cd frontend/platforms/web && npm run dev

# TV Platform (React Native Web)
FRONTEND_APP_2_NAME=tv
FRONTEND_APP_2_PORT=3001
FRONTEND_APP_2_ROUTE=tv
# Access: http://tv.local.nself.org
# Start: cd frontend/platforms/tv && npm run dev:web

# Mobile Platform (React Native Metro - dev preview only)
FRONTEND_APP_3_NAME=mobile
FRONTEND_APP_3_PORT=8081
FRONTEND_APP_3_ROUTE=mobile
# Access: http://mobile.local.nself.org
# Start: cd frontend/platforms/mobile && npm start

# Desktop Platform (Tauri dev server)
FRONTEND_APP_4_NAME=desktop
FRONTEND_APP_4_PORT=3002
FRONTEND_APP_4_ROUTE=desktop
# Access: http://desktop.local.nself.org
# Start: cd frontend/platforms/desktop && npm run tauri dev

# -----------------------------------------------------------------------------
# 9. APPLICATION-SPECIFIC CONFIGURATION
# -----------------------------------------------------------------------------

# Video Processing
VIDEO_TRANSCODE_FORMATS=mp4,webm,hls
VIDEO_QUALITY_LEVELS=360p,720p,1080p,4k
VIDEO_MAX_UPLOAD_SIZE=5GB

# CDN Configuration (for production)
CDN_ENABLED=false
CDN_ENDPOINT=https://cdn.nself.org
CDN_CACHE_TTL=86400

# Content Moderation
MODERATION_ENABLED=true
MODERATION_AUTO_APPROVE=false

# Analytics
ANALYTICS_ENABLED=true
ANALYTICS_PROVIDER=plausible

# -----------------------------------------------------------------------------
# 10. EXTERNAL SERVICE INTEGRATIONS (Optional)
# -----------------------------------------------------------------------------

# Stripe (payments - if needed)
STRIPE_ENABLED=false
STRIPE_PUBLIC_KEY=pk_test_...
STRIPE_SECRET_KEY=sk_test_...

# Twilio (notifications - if needed)
TWILIO_ENABLED=false
TWILIO_ACCOUNT_SID=AC...
TWILIO_AUTH_TOKEN=...

# AWS S3 (production storage - alternative to MinIO)
AWS_S3_ENABLED=false
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=...
AWS_SECRET_ACCESS_KEY=...
AWS_S3_BUCKET=nself-tv-prod-media

# -----------------------------------------------------------------------------
# 11. NSELF PLUGINS (Phase 5 - Live TV & DVR)
# -----------------------------------------------------------------------------

# Devices Plugin (IoT device enrollment, trust management)
DEVICES_PLUGIN_ENABLED=true
DEVICES_PLUGIN_PORT=3603
DEV_ENROLLMENT_TOKEN_TTL=86400
DEV_CHALLENGE_TTL=300
DEV_HEARTBEAT_INTERVAL=30
DEV_HEARTBEAT_TIMEOUT=90
DEV_COMMAND_DEFAULT_TIMEOUT=30
DEV_COMMAND_MAX_RETRIES=3
DEV_TELEMETRY_RETENTION_DAYS=90

# EPG Plugin (Electronic Program Guide)
EPG_PLUGIN_ENABLED=true
EPG_PLUGIN_PORT=3031
EPG_APP_IDS=nself-tv
EPG_XMLTV_URLS=https://raw.githubusercontent.com/iptv-org/epg/master/sites/xmltv/xmltv.org.channels.xml
EPG_SCHEDULES_DIRECT_USERNAME=
EPG_SCHEDULES_DIRECT_PASSWORD=
EPG_DEFAULT_TIMEZONE=America/New_York
EPG_GUIDE_DAYS_AHEAD=7

# Sports Plugin (Sports data, live scores, schedules)
SPORTS_PLUGIN_ENABLED=true
SPORTS_PLUGIN_PORT=3035
SPORTS_APP_IDS=nself-tv
SPORTS_PROVIDER=espn
SPORTS_PROVIDERS=espn,sportsdata
SPORTS_ESPN_API_KEY=
SPORTS_ESPN_API_URL=https://site.api.espn.com/apis/site/v2
SPORTS_SPORTSDATA_API_KEY=

# Recording Plugin (DVR recording orchestration)
RECORDING_PLUGIN_ENABLED=true
RECORDING_PLUGIN_PORT=3602
REC_STORAGE_URL=http://minio:9000
REC_FILE_PROCESSING_URL=http://video_processor:5005
REC_SPORTS_URL=http://sports:3035
REC_MEDIA_METADATA_URL=http://library_service:5001
REC_DEVICES_URL=http://devices:3603
REC_DEFAULT_LEAD_TIME_MINUTES=2
REC_DEFAULT_TRAIL_TIME_MINUTES=5

# -----------------------------------------------------------------------------
# NOTES
# -----------------------------------------------------------------------------
# - This file is committed to git (safe defaults only)
# - Create .env.local for personal overrides (gitignored)
# - Production secrets go in .env.prod + .secrets (on server only)
# - Run: nself build && nself start
# - Hasura Console: http://api.local.nself.org/console
# - Grafana: http://grafana.local.nself.org
# - MinIO Console: http://minio.local.nself.org
